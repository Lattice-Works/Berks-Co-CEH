# change limit for prod: select d.*, h."InformationDate" as "InformationDate_HDV", h."PregnancyStatus", h."DueDate", e."EntryDate", ex."ExitDate", e."DisablingCondition" from enrollment as e left join exit as ex on e."EnrollmentID"=ex."EnrollmentID" AND e."PersonalID"=ex."PersonalID" left join disabilities as d on e."EnrollmentID"=d."EnrollmentID" AND e."PersonalID"=d."PersonalID" left join health_and_dv as h on d."EnrollmentID"=h."EnrollmentID" AND e."PersonalID"=h."PersonalID" limit 5000;

# intelliJ: "select d.*, h.\"HealthAndDVID\", h.\"InformationDate\" as \"InformationDate_HDV\", h.\"PregnancyStatus\", h.\"DueDate\", e.\"EntryDate\", ex.\"ExitDate\", e.\"DisablingCondition\" from enrollment as e left join exit as ex on e.\"EnrollmentID\"=ex.\"EnrollmentID\" AND e.\"PersonalID\"=ex.\"PersonalID\" left join disabilities as d on e.\"EnrollmentID\"=d.\"EnrollmentID\" AND e.\"PersonalID\"=d.\"PersonalID\" left join health_and_dv as h on d.\"EnrollmentID\"=h.\"EnrollmentID\" AND e.\"PersonalID\"=h.\"PersonalID\" limit 5000; "

entityDefinitions:
  client: 
    fqn: "general.person"
    entitySetName: "BerksCEHClients"
    propertyDefinitions:
      nc.SubjectIdentification:
        type: "nc.SubjectIdentification"
        column: "PersonalID"
      ol.datasource: 
        type: "ol.datasource"
        transforms: 
        - !<transforms.ValueTransform>
          value: "Berks County CEH"
    conditions:
    - !<conditions.BooleanIsNullCondition>
      column: "PersonalID"
      reverse: false
    name: "client"

  enrollment:
    fqn: "ol.episode"
    entitySetName: "BerksCEHEnrollments"
    propertyDefinitions:
      ol.id:
        type: "ol.id"
        column: "EnrollmentID"
      ol.effectivedate: 
        type: "ol.effectivedate"
        column: "EntryDate"
        transforms:
        - !<transforms.DateTimeTransform>
          pattern: ["yyyy-MM-dd HH:mm:ss", "yyyy-MM-dd HH:mm:ss.S"]
      ol.datetimeend: 
        type: "ol.datetimeend"
        column: "ExitDate"
        transforms:
        - !<transforms.DateTimeTransform>
          pattern: ["yyyy-MM-dd HH:mm:ss", "yyyy-MM-dd HH:mm:ss.S"]
    name: "enrollment"

  disabilities: 
    fqn: "ol.healthcondition" 
    entitySetName: "BerksCEHDisabilities"
    propertyDefinitions:
      ol.id:
        type: "ol.id"
        column: "DisabilitiesID"
      ol.recordeddate: 
        type: "ol.recordeddate"
        column: "InformationDate"
        transforms:
        - !<transforms.DateTimeTransform>
          pattern: ["yyyy-MM-dd HH:mm:ss", "yyyy-MM-dd HH:mm:ss.S"]
      # ol.clinicalstatus: #taking out because this pertains to client in general
      #   type: "ol.clinicalstatus"
      #   column: "DisablingCondition" #from enrollment - does client have disabling condition
      #   transforms:
      #   - !<transforms.ParseIntTransform> {}
      #   - !<transforms.ReplaceTransform>
      #     target: ["0", "1", "8", "9", "99"]
      #     goal: ["No", "Yes", "Client doesn't know", "Client refused", "Data not collected"]
      health.mentalissue: 
        type: "health.mentalissue"
        transforms:
        - !<transforms.BooleanContainsTransform>
          column: "DisabilityType"
          string: "9"
          transformsIfTrue:
          - !<transforms.ValueTransform>
            value: "true"
          transformsIfFalse:
          - !<transforms.ValueTransform>
            value: ""
      # ol.substanceuse:
      #   type: "ol.substanceuse"
      #   transforms:
      #   - !<transforms.BooleanContainsTransform>
      #     column: "DisabilityType"
      #     string: "10"
      #     transformsIfTrue:
      #     - !<transforms.ValueTransform>
      #       value: "true"
      #     transformsIfFalse:
      #     - !<transforms.ValueTransform>
      #       value: ""
      ol.name: 
        type: "ol.name"
        column: "DisabilityType"
        transforms:
        - !<transforms.ParseIntTransform> {}
        - !<transforms.ReplaceTransform>
          target: ["5", "6", "7", "8", "9", "10"]
          goal: ["Physical disability", "Developmental disability", "Chronic health condition", "HIV/AIDS", "Mental health problem", "Substance abuse"]
      # ol.clinicalstatus: # put substance abuse in its own entity
      #   type: "ol.clinicalstatus"
      #   transforms: 
      #   - !<transforms.BooleanContainsTransform>
      #     column: "DisabilityType"
      #     string: "10"
      #     transformsIfTrue:
      #     - !<transforms.ParseIntTransform>
      #       column: "DisabilityResponse"
      #     - !<transforms.ReplaceTransform>
      #       target: ["0", "1", "2", "3", "8", "9", "99"]
      #       goal: ["Substance Abuse: No", "Alcohol abuse", "Drug abuse", "Both alcohol and drug abuse", "Client doesn't know", "Client refused", "Data not collected"]
      ol.clinicalstatus1: 
        type: "ol.clinicalstatus"
        transforms:
        - !<transforms.BooleanContainsTransform>
          column: "DisabilityType"
          string: "5"
          transformsIfTrue:
          - !<transforms.ParseIntTransform> {}
            column: "DisabilityResponse"
          - !<transforms.ReplaceTransform>
            target: ["0", "1", "8", "9", "99"]
            goal: ["No", "Yes", "Client doesn't know", "Client refused", "Data not collected"]
      ol.clinicalstatus2: 
        type: "ol.clinicalstatus"
        transforms:
        - !<transforms.BooleanContainsTransform>
          column: "DisabilityType"
          string: "6"
          transformsIfTrue:
          - !<transforms.ParseIntTransform> {}
            column: "DisabilityResponse"
          - !<transforms.ReplaceTransform>
            target: ["0", "1", "8", "9", "99"]
            goal: ["No", "Yes", "Client doesn't know", "Client refused", "Data not collected"]
      ol.clinicalstatus3: 
        type: "ol.clinicalstatus"
        transforms:
        - !<transforms.BooleanContainsTransform>
          column: "DisabilityType"
          string: "7"
          transformsIfTrue:
          - !<transforms.ParseIntTransform> {}
            column: "DisabilityResponse"
          - !<transforms.ReplaceTransform>
            target: ["0", "1", "8", "9", "99"]
            goal: ["No", "Yes", "Client doesn't know", "Client refused", "Data not collected"]
      ol.clinicalstatus4: 
        type: "ol.clinicalstatus"
        transforms:
        - !<transforms.BooleanContainsTransform>
          column: "DisabilityType"
          string: "8"
          transformsIfTrue:
          - !<transforms.ParseIntTransform> {}
            column: "DisabilityResponse"
          - !<transforms.ReplaceTransform>
            target: ["0", "1", "8", "9", "99"]
            goal: ["No", "Yes", "Client doesn't know", "Client refused", "Data not collected"]
      ol.clinicalstatus5: 
        type: "ol.clinicalstatus"
        transforms:
        - !<transforms.BooleanContainsTransform>
          column: "DisabilityType"
          string: "9"
          transformsIfTrue:
          - !<transforms.ParseIntTransform> {}
            column: "DisabilityResponse"
          - !<transforms.ReplaceTransform>
            target: ["0", "1", "8", "9", "99"]
            goal: ["No", "Yes", "Client doesn't know", "Client refused", "Data not collected"]
      ol.severity: 
        type: "ol.severity"
        column: "IndefiniteAndImpairs"
        transforms:
        - !<transforms.ParseIntTransform> {}
        - !<transforms.ReplaceTransform> 
          target: ["0", "1", "8", "9", "99"]
          goal: ["No", "Yes", "Client doesn't know", "Client refused", "Data not collected"]
    name: "disabilities"

  substanceabuse: 
    fqn: "ol.substance"
    entitySetName: "BerksCEHSubstanceAbuse"
    propertyDefinitions: 
      general.id: 
        type: "general.id"
        column: "DisabilitiesID"
      ol.datelastreported:
        type: "ol.datelastreported"
        column: "InformationDate"
        transforms:
        - !<transforms.DateTimeTransform>
          pattern: ["yyyy-MM-dd HH:mm:ss", "yyyy-MM-dd HH:mm:ss.S"]
      ol.substanceuseindicator:
        type: "ol.substanceuseindicator"
        transforms:
        - !<transforms.BooleanContainsTransform>
          column: "DisabilityType"
          string: "10"
          transformsIfTrue:
          - !<transforms.ValueTransform>
            value: true
      ol.type:
        type: "ol.type"
        column: "DisabilityResponse"
        transforms:
        - !<transforms.ParseIntTransform> {}
        - !<transforms.ReplaceTransform>
          target: ["0", "1", "2", "3", "8", "9", "99"]
          goal: ["No", "Alcohol abuse", "Drug abuse", "Both alcohol and drug abuse", "Client doesn't know", "Client refused", "Data not collected"]
    name: "substanceabuse"


  pregnancy:
    fqn: "ol.healthcondition"
    entitySetName: "BerksCEHPregnancy"
    propertyDefinitions:
      ol.id: 
        type: "ol.id"
        column: "HealthAndDVID"
      ol.name: 
        type: "ol.name"
        transforms:
        - !<transforms.ValueTransform>
          value: "Pregnancy Status"
      ol.recordeddate:  
        type: "ol.recordeddate"
        column: "InformationDate_HDV"
        transforms:
        - !<transforms.DateTimeTransform>
          pattern: ["yyyy-MM-dd HH:mm:ss", "yyyy-MM-dd HH:mm:ss.S"]
      ol.clinicalstatus:
        type: "ol.clinicalstatus"
        column: "PregnancyStatus"
        transforms: 
        - !<transforms.ParseIntTransform> {}
        - !<transforms.ReplaceTransform>
          target: ["0", "1", "8", "9", "99"] 
          goal: ["No", "Yes", "Client doesn't know", "Client refused", "Data not collected"]
      ol.enddate:
        type: "ol.enddate"
        column: "DueDate"
        transforms:
        # - !<transforms.DateTimeTransform>
        - !<transforms.DateTimeAsDateTransform>
          pattern: ["yyyy-MM-dd HH:mm:ss"]
    conditions: 
    - !<conditions.BooleanIsNullCondition>
      column: "PregnancyStatus"
      reverse: true
    name: "pregnancy"

associationDefinitions: 
  observedin1:
    fqn: "ol.observedin"
    entitySetName: "BerksObservedIn"
    src: "disabilities"
    dst: "client"
    propertyDefinitions:
      ol.id:
        type: "ol.id"
        transforms: 
        - !<transforms.ConcatTransform>
          columns: ["DisabilitiesID", "PersonalID"]
      date.completeddatetime: 
        type: "date.completeddatetime"
        column: "InformationDate"
        transforms: 
        - !<transforms.DateTimeTransform>
          pattern: ["yyyy-MM-dd HH:mm:ss"]
    name: "observedin1"

  observedin2:
    fqn: "ol.observedin"
    entitySetName: "BerksObservedIn"
    src: "pregnancy"
    dst: "client"
    propertyDefinitions:
      ol.id:
        type: "ol.id"
        transforms: 
        - !<transforms.ConcatTransform>
          columns: ["HealthAndDVID", "PersonalID"]
      date.completeddatetime: 
        type: "date.completeddatetime"
        column: "InformationDate_HDV"
        transforms: 
        - !<transforms.DateTimeTransform>
          pattern: ["yyyy-MM-dd HH:mm:ss"]      
    name: "observedin2"

  observedin3:
    fqn: "ol.observedin"
    entitySetName: "BerksObservedIn"
    src: "substanceabuse"
    dst: "client"
    propertyDefinitions:
      ol.id:
        type: "ol.id"
        transforms: 
        - !<transforms.ConcatTransform>
          columns: ["DisabilitiesID", "PersonalID"]
      date.completeddatetime: 
        type: "date.completeddatetime"
        column: "InformationDate"
        transforms: 
        - !<transforms.DateTimeTransform>
          pattern: ["yyyy-MM-dd HH:mm:ss"]      
    name: "observedin3"

  addresses1:
    fqn: "ol.addresses"
    entitySetName: "BerksAddresses"
    src: "enrollment"
    dst: "disabilities"
    propertyDefinitions:
      ol.id:
        type: "ol.id"
        transforms: 
        - !<transforms.ConcatTransform>
          columns: ["EnrollmentID", "DisabilitiesID"]
      date.completeddatetime: 
        type: "date.completeddatetime"
        column: "InformationDate"
        transforms: 
        - !<transforms.DateTimeTransform>
          pattern: ["yyyy-MM-dd HH:mm:ss", "yyyy-MM-dd HH:mm:ss.S"]      
    name: "addresses1"

  addresses2:
    fqn: "ol.addresses"
    entitySetName: "BerksAddresses"
    src: "enrollment"
    dst: "pregnancy"
    propertyDefinitions:
      ol.id:
        type: "ol.id"
        transforms: 
        - !<transforms.ConcatTransform>
          columns: ["EnrollmentID", "HealthAndDVID"]
      date.completeddatetime: 
        type: "date.completeddatetime"
        column: "InformationDate_HDV"
        transforms: 
        - !<transforms.DateTimeTransform>
          pattern: ["yyyy-MM-dd HH:mm:ss", "yyyy-MM-dd HH:mm:ss.S"]      
    name: "addresses2"

  addresses3:
    fqn: "ol.addresses"
    entitySetName: "BerksAddresses"
    src: "enrollment"
    dst: "substanceabuse"
    propertyDefinitions:
      ol.id:
        type: "ol.id"
        transforms: 
        - !<transforms.ConcatTransform>
          columns: ["EnrollmentID", "DisabilitiesID"]
      date.completeddatetime: 
        type: "date.completeddatetime"
        column: "InformationDate"
        transforms: 
        - !<transforms.DateTimeTransform>
          pattern: ["yyyy-MM-dd HH:mm:ss", "yyyy-MM-dd HH:mm:ss.S"]      
    name: "addresses3"

  # partof1:
  #   fqn: "ol.exhibits"
  #   entitySetName: "BerksPartOf"
  #   src: "disabilities"
  #   dst: "enrollment"
  #   propertyDefinitions:
  #     ol.id:
  #       type: "ol.id"
  #       column: "EnrollmentID"
  #   name: "partof1"


  # partof2:
  #   fqn: "ol.exhibits"
  #   entitySetName: "BerksPartOf"
  #   src: "pregnancy"
  #   dst: "enrollment"
  #   propertyDefinitions:
  #     ol.id:
  #       type: "ol.id"
  #       column: "EnrollmentID"
  #   name: "partof2"

  presentsfor:
    fqn: "ol.presentsfor"
    entitySetName: "BerksPresentsFor"
    src: "client"
    dst: "enrollment"
    propertyDefinitions: 
      ol.id: 
        type: "ol.id"
        transforms:
        - !<transforms.ConcatTransform>
          columns: ["PersonalID", "EnrollmentID"]
          separator: "_"
      date.completeddatetime:
        type: "date.completeddatetime" 
        column: "EntryDate"
        transforms:
        - !<transforms.DateTimeTransform>
          pattern: ["yyyy-MM-dd HH:mm:ss", "yyyy-MM-dd HH:mm:ss.S"]
    name: "presentsfor"

